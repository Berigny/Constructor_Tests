<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <script src="https://unpkg.com/streamlit-component-lib@1.4.0/dist/index.js"></script>
    <style>
      :root {
        color-scheme: light;
      }
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: #2c2c2c;
      }
      .img-choice-grid {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        align-items: stretch;
      }
      .img-choice-grid button {
        flex: 1;
        border: none;
        padding: 0;
        border-radius: 12px;
        overflow: hidden;
        background-color: #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }
      .img-choice-grid button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
      }
      .img-choice-grid button:focus-visible {
        outline: 3px solid #4a90e2;
        outline-offset: 3px;
      }
      .img-choice-grid img {
        width: 100%;
        height: 240px;
        object-fit: cover;
        display: block;
      }
      .img-choice-actions {
        margin-top: 1rem;
        text-align: center;
      }
      .img-choice-actions button {
        border: 1px solid #444;
        background: transparent;
        color: #444;
        padding: 0.6rem 1.6rem;
        border-radius: 999px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.15s ease, color 0.15s ease, border-color 0.15s ease;
      }
      .img-choice-actions button:hover,
      .img-choice-actions button:focus-visible {
        background: #444;
        color: #fff;
        border-color: #444;
      }
      .img-choice-empty {
        text-align: center;
        font-size: 0.9rem;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script>
      const root = document.getElementById("root");
      const { Streamlit } = window;

      function render(event) {
        const args = event.detail.args || {};
        const images = Array.isArray(args.images) ? args.images : [];
        const alts = Array.isArray(args.alts) ? args.alts : [];
        root.innerHTML = "";

        if (images.length >= 2) {
          const grid = document.createElement("div");
          grid.className = "img-choice-grid";
          for (let idx = 0; idx < 2; idx += 1) {
            const src = images[idx] || "";
            const alt = alts[idx] || "";
            const button = document.createElement("button");
            button.type = "button";
            button.dataset.choice = idx === 0 ? "left" : "right";
            const img = document.createElement("img");
            img.src = src;
            img.alt = alt;
            button.appendChild(img);
            grid.appendChild(button);
          }
          root.appendChild(grid);

          const actions = document.createElement("div");
          actions.className = "img-choice-actions";
          const neither = document.createElement("button");
          neither.type = "button";
          neither.dataset.choice = "neither";
          neither.textContent = "Neither match";
          actions.appendChild(neither);
          root.appendChild(actions);
        } else {
          const empty = document.createElement("div");
          empty.className = "img-choice-empty";
          empty.textContent = "Add two images to compare.";
          root.appendChild(empty);
        }

        root.querySelectorAll("[data-choice]").forEach((el) => {
          el.addEventListener("click", (eventClick) => {
            eventClick.preventDefault();
            eventClick.stopPropagation();
            const choice = el.dataset.choice || null;
            if (choice && Streamlit && typeof Streamlit.setComponentValue === "function") {
              Streamlit.setComponentValue(choice);
            }
          });
        });

        if (Streamlit && typeof Streamlit.setFrameHeight === "function") {
          const height = root.getBoundingClientRect().height + 16;
          Streamlit.setFrameHeight(height);
        }
      }

      if (Streamlit) {
        Streamlit.events.addEventListener(Streamlit.RENDER_EVENT, (event) => {
          render(event);
        });
        Streamlit.setComponentReady();
        Streamlit.setFrameHeight(0);
      }
    </script>
  </body>
</html>
